# Subset Selection using Clustering Results

## Command

1. Run the commandline interface.

```bash
python cli.py run --shards_path='<path to cluster directory>/shard-{<shard range>}.pkl' \
    --meta_path=<path to metadata directory> \
    --out_path=<path to output directory>/output.csv
```

where `<path to metadata directory>` is the directory containing the metadata json files.

The above code will append to the `output.csv` file when the file exists, and create a new file if not.
It is advisable to differentiate the `out_path` option when running multiple runs simultaneously.
Otherwise each process may try to append to the same `out_path` at the same time, resulting in a file io conflict.

## File Structures

### Outputs

`output.csv` is a headerless comma-seperated csv file.
The fields are as follows:
```
SHARD_NAME,FILENAME,YOUTUBE_ID,SEGMENT
```

e\.g\.
```
shard-000009,qpxektwhzra_292.mp4,qpxektwhzra,"[292.3329999997, 302.3329999997]"
```

When the metadata does not exist in the corresponding json file, the segment defaults to `[-1.0,-1.0]`.
```
shard-000009,qpxektwhzra_292.mp4,-1,"[-1.0, -1.0]"
```

### Logs

Internally, we use `$SHARD_CLUSTERING_DIR/log_*.json` files to keep track of
which clustering results are generated by which run.
Using these log files, we group the given shards by clustering runs.
